<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8">
<title>JOOBIN Dashboard — Milestones • Deliverables • Payments • Config</title>
<meta name="viewport" content="width=device-width, initial-scale=1">
<style>
:root { --ok:#2e7d32; --warn:#d32f2f; --muted:#666; --bg:#fafafa; --card:#fff; --line:#eee; }
body { font-family: system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif; margin: 24px; background: var(--bg); }
header { display: flex; gap: 12px; align-items: center; justify-content: space-between; margin-bottom: 12px; }
.btn { padding: 8px 12px; border-radius: 6px; border: 1px solid #ccc; background: #fff; cursor: pointer; }
.btn:disabled { opacity: 0.5; cursor: not-allowed; }
#status { color: var(--muted); }
.grid { display: grid; gap: 16px; grid-template-columns: repeat(auto-fit, minmax(320px, 1fr)); }
section { background: var(--card); border: 1px solid var(--line); border-radius: 10px; padding: 16px; }
h2 { margin: 0 0 12px; font-size: 16px; }
.row { padding: 10px 0; border-bottom: 1px solid var(--line); }
.row:last-child { border-bottom: 0; }
.sub { color: var(--muted); font-size: 12px; }
.ok { color: var(--ok); font-weight: 600; }
.warn { color: var(--warn); font-weight: 600; }
.pill { display: inline-block; padding: 2px 8px; border-radius: 999px; border: 1px solid var(--line); background: #fff; font-size: 12px; }
.kpis { display: flex; gap: 8px; flex-wrap: wrap; margin-top: 6px; }
footer { margin-top: 16px; color: var(--muted); font-size: 12px; }
</style>
</head>
<body>
<header>
<div>
<h1 style="margin:0;font-size:18px;">JOOBIN Command Snapshot</h1>
<div class="sub">Live via Netlify Function → Notion API</div>
</div>
<div>
<button id="loadBtn" class="btn">Load</button>
</div>
</header>
<div class="grid">
<section>
<h2>Milestones</h2>
<div id="milestones"></div>
</section>
<section>
<h2>Deliverables</h2>
<div id="deliverables"></div>
</section>
<section>
<h2>Payments</h2>
<div id="payments"></div>
</section>
<section>
<h2>Config</h2>
<div id="config"></div>
</section>
</div>
<footer>
Tip: Click Load to refresh. Values reflect your Notion databases in real time.
</footer>
<script>
const $ = (id) => document.getElementById(id);
function get(obj, path, dflt=null){try{const parts=path.split('.');let cur=obj;for(const k of parts){if(cur==null) return dflt;cur = cur[k];}return cur??dflt;}catch{return dflt;}}
async function j(url, opts){const r=await fetch(url, opts); if(!r.ok) throw new Error(await r.text()); return r.json();}
function renderMilestones(data){
const el = $('milestones'); el.innerHTML = '';
const rows = (data.results||[]).slice(0,12);
if(rows.length===0){ el.textContent='No milestones'; return; }
rows.forEach(p=>{
const props=p.properties||{};
const title=get(props,'MilestoneTitle.title.0.plain_text','(untitled)');
const phase=get(props,'Phase.select.name','-');
const status=get(props,'Status.select.name','-');
const pv=get(props,'Paid vs Budget (%).formula.number',0) || 0;
const badge = pv >= 1 ? 'warn' : 'ok';
const div=document.createElement('div');
div.className='row';
div.innerHTML = `
<div><strong>${title}</strong></div>
<div class="sub">${phase} • ${status}</div>
<div class="kpis">Paid vs Budget: ${(pv).toFixed(2)}</div>
`;
el.appendChild(div);
});
}
function renderDeliverables(data){
const el = $('deliverables'); el.innerHTML='';
const rows=(data.results||[]).slice(0,12);
if(rows.length===0){ el.textContent='No deliverables'; return; }
rows.forEach(p=>{
const props=p.properties||{};
const name=get(props,'Deliverable Name.title.0.plain_text','(untitled)');
const gate=get(props,'Gate.select.name','-');
const st=get(props,'Status.select.name','-');
const div=document.createElement('div'); div.className='row';
div.innerHTML=<div><strong>${name}</strong></div><div class="sub">${gate} • <span class="pill">${st}</span></div>;
el.appendChild(div);
});
}
function renderPayments(data){
const el = $('payments'); el.innerHTML='';
const rows=(data.results||[]).slice(0,12);
if(rows.length===0){ el.textContent='No payments'; return; }
rows.forEach(p=>{
const props=p.properties||{};
const title=get(props,'Payment For.title.0.plain_text','(untitled)');
const status=get(props,'Status.select.name','-');
const amt = get(props,'Amount (RM).number',0)||0;
const due = get(props,'DueDate.date.start','');
const div=document.createElement('div'); div.className='row';
div.innerHTML=`<div><strong>${title}</strong></div>
<div class="sub">${status} • RM ${amt.toLocaleString(undefined,{minimumFractionDigits:2,maximumFractionDigits:2})} • ${due||'-'}</div>`;
el.appendChild(div);
});
}
function renderConfig(data){
const el = $('config'); el.innerHTML='';
const rows=(data.results||[]).slice(0,12);
if(rows.length===0){ el.textContent='No config'; return; }
rows.forEach(p=>{
const props=p.properties||{};
const k=get(props,'Key.title.0.plain_text','(key)');
const v=get(props,'Value.rich_text.0.plain_text','');
const div=document.createElement('div'); div.className='row';
div.innerHTML=<div><strong>${k}</strong></div><div class="sub">${v}</div>;
el.appendChild(div);
});
}
async function loadAll(){
const btn=$('loadBtn'); const st=$('status');
btn.disabled=true; st.textContent='Loading…';
try{
const [ms,dv,py,cfg] = await Promise.all([
j('/api?type=milestones'),
j('/api?type=deliverables'),
j('/api?type=payments'),
j('/api?type=config'),
]);
renderMilestones(ms); renderDeliverables(dv); renderPayments(py); renderConfig(cfg);
st.textContent='Loaded';
}catch(e){
console.error(e); st.textContent='Error — see console'; alert('Failed: '+e.message);
}finally{ btn.disabled=false; }
}
$('loadBtn').addEventListener('click', loadAll);
</script>
</body>
</html>