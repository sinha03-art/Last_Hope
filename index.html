<!DOCTYPE html>

<html lang="en">

<head>

<meta charset="UTF-8" />

<meta name="viewport" content="width=device-width, initial-scale=1.0" />

<title>Project Dashboard</title>

<!-- Favicon -->

<link rel="icon" href="data:image/svg+xml,%3Csvg xmlns='https://www.w3.org/2000/svg'' viewBox='0 0 100 100'%3E%3Ctext y='.9em' font-size='90'%3EðŸ %3C/text%3E%3C/svg%3E">

<!-- Fonts + Tailwind -->

<link rel="preconnect" href="https://fonts.googleapis.com/">

<link rel="preconnect" href="https://fonts.gstatic.com/" crossorigin>

<link href="https://fonts.googleapis.com/css2?family=Lato:wght@400;700;900&display=swap" rel="stylesheet">

<script src="https://cdn.tailwindcss.com/"></script>

<!-- Chart.js (UMD) -->

<script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.4/dist/chart.umd.min.js" crossorigin="anonymous"></script>

<style>

:root{ --bg:#f1f3f5; --panel:#ffffff; --ink:#0f172a; --muted:#64748b; --brand:#e11d48; --nav:#0f2133; --nav-ink:#e2e8f0;}

.dark { --bg:#0b1220; --panel:#0f172a; --ink:#e5e7eb; --muted:#93a3b8; --nav:#0b1220; --nav-ink:#e5e7eb; }

html,body{height:100%}

body{font-family:"Lato",system-ui,-apple-system,Segoe UI,Roboto,Helvetica,Arial; background:var(--bg); color:var(--ink); margin:0;}

.pill{font-weight:800;font-size:.625rem; line-height:1; padding:.25rem .4rem; border-radius:999px; background:#ef4444; color:#fff;}

.nav-sep{box-shadow: inset 0 -1px 0 0 rgba(255,255,255,0.06);}

.hr{height:1px; background:#e5e7eb;}

.top-shadow{box-shadow: 0 1px 0 rgba(15,33,51,.06);}

.kpi{border:1px solid #e5e7eb; border-radius:.75rem; padding:1rem; background:var(--panel)}

.card{background:var(--panel); border:1px solid #e5e7eb; border-radius:.75rem;}

/ *Sidebar video wrapper (16:9)* /

.sidebar-video { position:relative; width:100%; overflow:hidden; border-radius:.5rem; margin-bottom:.75rem; padding-top:56.25%;}

.sidebar-video iframe { position:absolute; inset:0; width:100%; height:100%; display:block; }

/ *Chart area* /

#cashflowBox { height: 220px; }

/ *Payable / Blocked badges and reason lines* /

.badge { display:inline-block; font-size:.65rem; font-weight:700; line-height:1; padding:.2rem .45rem; border-radius:999px; margin-left:.5rem; }

.badge-ok { background:#d1fae5; color:#065f46 }     / *Payable* /

.badge-warn { background:#fde68a; color:#92400e }   / *Upcoming blocked* /

.badge-stop { background:#fee2e2; color:#991b1b }   / *Overdue blocked* /

.reason { display:block; font-size:.72rem; color:#475569; margin-top:.15rem; }

/ *GO / NO-GO styles* /

.gochip { background:#d1fae5; color:#065f46; padding:.5rem 1rem; border-radius:999px; font-weight:900; font-size:.875rem; }

.nogochip { background:#fee2e2; color:#991b1b; padding:.5rem 1rem; border-radius:999px; font-weight:900; font-size:.875rem; }

.gocard { background:#ecfdf5; border-color:#a7f3d0; }

.nogocard { background:#fef2f2; border-color:#fca5a5; }

/ *Compact lists + separators* /

.sep { height:1px; background:#e5e7eb; margin:8px 0; }

.dark .sep { background: rgba(255,255,255,.12); }

.compact-list li { padding:6px 0; display:flex; justify-content:space-between; gap:12px; align-items:baseline; }

.compact-list .left { min-width:0; overflow:hidden; text-overflow:ellipsis; white-space:nowrap; }

.compact-list .right { text-align:right; white-space:nowrap; }

/ *Compressed progress bars (Codelab-like)* /

.progress { width:100%; background:#e5e7eb; height:6px; border-radius:999px; overflow:hidden; }

.dark .progress { background:rgba(255,255,255,.12); }

.progress > span { display:block; height:100%; background:#10b981; }

</style>

</head>

<body>

<div class="min-h-screen grid grid-cols-[260px_1fr]">

<!-- Sidebar -->

<aside class="bg-[var(--nav)] text-[var(--nav-ink)]">

<div class="p-6">

<div class="sidebar-video">

<iframe

src="https://player.vimeo.com/video//1121406919?h=abcdef&badge=0&title=0&byline=0&portrait=0"

title="JOOBIN Residence â€” 1â€‘minute overview video"

frameborder="0"

allow="autoplay; fullscreen; picture-in-picture"

allowfullscreen

loading="lazy"></iframe>

</div>

<div class="leading-tight">

<p class="font-black tracking-wide uppercase">JOOBIN</p>

<p class="text-[10px] opacity-70">Assets</p>

</div>

<div class="mt-3 text-[13px] text-white">

<p><strong>Project:</strong> JOOBIN Residence</p>

<p><strong>Status:</strong> 3D design stage. Construction not started.</p>

<p class="text-[12px] opacity-70">
The Renovation will significantly expand the livable square footage on all levels through major structural additions to the rear, sides, and rooftop. Notable enhancements include a new roof terrace, a covered car porch, and enlarged master, junior, and parent suites, with the latter featuring a lounge and wardrobe.

The design opens up terraces and courtyards, improves circulation with wider hallways, and Modernizes the facade with updated materials and glazing. Sustainability is addressed via rooftop solar zones. 

Every level sees Functional upgradesâ€”from the reimagined laundry and kitchen areas to the addition of a library and improved outdoor spaces.</p>

</div>

</div>

<nav class="mt-4 text-sm">

<div class="px-6 py-3 text-[.8rem] tracking-widest uppercase opacity-60">Pages</div>

<ul>

<li class="nav-sep"><a class="flex items-center justify-between px-6 py-3 hover:bg-white/5" href="#">Dosier</a></li>

<li class="nav-sep">

<a class="flex items-center justify-between px-6 py-3 hover:bg-white/5" href="/deliverables.html">

Gate DeliverablesNew

</a>

</li>

<li class="nav-sep"><a class="flex items-center justify-between px-6 py-3 hover:bg-white/5" href="#">Project Stage</a></li>

<li class="nav-sep"><a class="flex items-center justify-between px-6 py-3 hover:bg-white/5" href="#">MediaNew</a></li>

<li class="nav-sep"><a class="flex items-center justify-between px-6 py-3 hover:bg-white/5" href="#">Tasks</a></li>

<li class="nav-sep"><a class="flex items-center justify-between px-6 py-3 hover:bg-white/5" href="#">Forms</a></li>

</ul>

</nav>

</aside>

<!-- Main -->

<div class="flex flex-col">

<header class="card top-shadow">

<div class="h-14 flex items-center justify-between px-6">

<p class="font-black tracking-wide">Dashboard</p>

<div class="flex items-center gap-3">

<button id="themeToggle" class="text-xs px-3 py-1 rounded border border-slate-300/50 hover:bg-slate-50 dark:hover:bg-slate-800">Dark</button>

<div class="text-xs opacity-70">JOOBIN</div>

</div>

</div>

</header>

<!-- GO / NO-GO Banner -->

<section id="goNoGo" class="mx-6 mt-4">

<div id="goNoGoCard" class="card p-4 flex items-center justify-between">

<div>

<p class="text-xs uppercase text-[var(--muted)]">Preâ€‘construction readiness</p>

<p id="goNoGoMsg" class="text-lg font-bold">Checkingâ€¦</p>

<p id="goNoGoReason" class="text-xs text-[var(--muted)] mt-1"></p>

</div>

â€”

</div>

</section>

<main class="p-6 space-y-6">

<!-- KPIs -->

<section class="grid grid-cols-1 md:grid-cols-2 xl:grid-cols-4 gap-4">

<div class="kpi">

<p class="text-xs uppercase text-[var(--muted)]">Paid vs Budget</p>

<p id="kpiPaidVsBudget" class="text-3xl font-black">0%</p>

</div>

<div class="kpi">

<p class="text-xs uppercase text-[var(--muted)]">Deliverables Approved</p>

<p id="kpiDeliverables" class="text-3xl font-black">0%</p>

</div>

<div class="kpi">

<p class="text-xs uppercase text-[var(--muted)]">Milestones At Risk</p>

<p id="kpiRisk" class="text-3xl font-black">0</p>

</div>

<div class="kpi">

<p class="text-xs uppercase text-[var(--muted)]">Next 30d Due</p>

<p id="kpiNext30" class="text-3xl font-black">RM 0</p>

<p id="kpiNext30Count" class="text-xs text-[var(--muted)] mt-1">0 items</p>

</div>

</section>

<!-- Attention Board + Cashflow -->

<section class="grid grid-cols-12 gap-6">

<div class="col-span-12 lg:col-span-6 card p-6">

<h3 class="font-black tracking-wide mb-3">Attention Board</h3>

<p class="text-xs uppercase text-[var(--muted)] mb-2">Overdue payments</p>

<ul id="overdueList" class="compact-list"></ul>

<div class="sep"></div>

<p class="text-xs uppercase text-[var(--muted)] mb-2">90 day payment forecast</p>

<ul id="forecast90" class="compact-list"></ul>

</div>

<div class="col-span-12 lg:col-span-6 card p-6">

<h3 class="font-black tracking-wide mb-3">Cashflow (Scheduled vs Paid)</h3>

<div id="cashflowBox" class="relative">

<canvas id="cashflowChart" height="220" style="width:100%;"></canvas>

</div>

</div>

</section>

<!-- Compressed Gates + Vendors -->

<section class="grid grid-cols-12 gap-6">

<div class="col-span-12 xl:col-span-8 card p-6">

<h3 class="font-black tracking-wide mb-3">Gate Progress (compressed)</h3>

<ul id="gatesCompressed" class="space-y-3"></ul>

</div>

<div class="col-span-12 xl:col-span-4 card p-6">

<h3 class="font-black tracking-wide mb-3">Top Vendors Outstanding</h3>

<ul id="topVendors" class="space-y-2 text-sm"></ul>

</div>

</section>

<!-- Weekly AI Summary -->

<section class="card p-6">

<div class="flex items-center justify-between">

<h3 class="font-black tracking-wide">Weekly AI Summary</h3>

<button id="genSummary" class="px-4 py-2 bg-rose-600 text-white font-bold rounded hover:bg-rose-700">Generate</button>

</div>

<div id="summaryOut" class="mt-4 text-sm whitespace-pre-line"></div>

</section>

<!-- Status line -->

<div id="status" class="px-1 text-xs text-rose-600"></div>

</main>

</div>

</div>

<script>

// THEME

const btn = document.getElementById('themeToggle');

function applyTheme(t){ document.body.classList.toggle('dark', t==='dark'); localStorage.setItem('theme', t); btn.textContent = t==='dark' ? 'Light' : 'Dark'; if (dataCache && cashflowChart) renderCashflow(dataCache.cashflow||[]); }

applyTheme(localStorage.getItem('theme') || 'light');

btn.addEventListener('click', () => applyTheme(document.body.classList.contains('dark') ? 'light':'dark'));

// HELPERS

const fmtMYR = v => (v||0).toLocaleString('en-MY', { style:'currency', currency:'MYR', maximumFractionDigits:0 });

const fmtMYR0 = v => (v||0).toLocaleString('en-MY', { style:'currency', currency:'MYR', maximumFractionDigits:0 });

const fmtDate = s => s ? new Date(s).toLocaleDateString('en-GB', { day:'2-digit', month:'short' }) : 'â€”';

const fmtDM = s => s ? new Date(s).toLocaleDateString('en-GB', { day:'2-digit', month:'short' }) : 'â€”';

const monthLabel = d => d.toLocaleDateString('en-GB', { month:'short', year:'numeric' });

let dataCache = null;

function li(html){ const el=document.createElement('li'); el.className='flex justify-between gap-3 items-start'; el.innerHTML=html; return el; }

// GO / NO-GO

function renderGoNoGo(a){

const card = document.getElementById('goNoGoCard');

const chip = document.getElementById('goNoGoChip');

const msg  = document.getElementById('goNoGoMsg');

const why  = document.getElementById('goNoGoReason');

const hasPreBlock = (list=[]) => list.some(p => Array.isArray(p.blockedReasons) && p.blockedReasons.some(r => r.toLowerCase().includes('preâ€‘construction')));

const preBlocked = hasPreBlock(a.paymentsOverdue||[]) || hasPreBlock(a.paymentsUpcoming||[]);

card.classList.remove('gocard','nogocard'); chip.classList.remove('gochip','nogochip');

if (preBlocked){ card.classList.add('nogocard'); chip.classList.add('nogochip'); chip.textContent='NOâ€‘GO'; msg.textContent='Preâ€‘construction prerequisites not fully approved'; why.textContent='Approve all mandatory items before work or payment proceeds.'; }

else { card.classList.add('gocard'); chip.classList.add('gochip'); chip.textContent='GO'; msg.textContent='Preâ€‘construction prerequisites satisfied'; why.textContent='You can proceed with scheduled work and pay Payable items only.'; }

}

// KPIs

function renderKPIs(k){

document.getElementById('kpiPaidVsBudget').textContent = (((k.paidVsBudget||0)*100).toFixed(1))+'%';

document.getElementById('kpiDeliverables').textContent = (((k.deliverablesProgress||0)*100).toFixed(0))+'%';

document.getElementById('kpiRisk').textContent = (k.milestonesAtRisk||0);

document.getElementById('kpiNext30').textContent = fmtMYR([k.next](http://k.next)30?.amount||0);

document.getElementById('kpiNext30Count').textContent = ([k.next](http://k.next)30?.count||0)+' items';

}

// Attention Board â€” Overdue compact

function renderOverdue(overdue){

const ul = document.getElementById('overdueList'); if (!ul) return;

ul.innerHTML = '';

(overdue||[]).forEach(p => {

ul.insertAdjacentHTML('beforeend', `

<li>

${p.vendor || 'Unknown'}

${fmtMYR0(p.amount)}

 â€¢ due ${fmtDM(p.dueDate)}

</span>

</li>

`);

});

if ((overdue||[]).length===0) ul.innerHTML = `<li><span class="left text-[var(--muted)] text-sm">No overdue items</span></li>`;

}

// 90 Day Payment Forecast

function renderForecast90(payments){

const ul = document.getElementById('forecast90'); if (!ul) return; ul.innerHTML='';

const now = new Date(); const in90 = new Date(now.getTime()+90*24*60*60*1000);

const upcoming = (payments||[]).filter(p => p.status!=='Paid' && p.dueDate && new Date(p.dueDate)>=now && new Date(p.dueDate)<=in90);

const byMonth = {};

upcoming.forEach(p=>{ const d=new Date(p.dueDate); const ym=`${d.getFullYear()}-${String(d.getMonth()+1).padStart(2,'0')}`; (byMonth[ym] ||= []).push(p); });

const months = Object.keys(byMonth).sort().slice(0,6);

months.forEach((ym, idx) => {

const list = byMonth[ym]; const d = new Date(ym+'-01'); const label = monthLabel(d);

const total = list.reduce((s,p)=> s+(p.amount||0),0);

ul.insertAdjacentHTML('beforeend', `<li><span class="left font-semibold">${label}</span><span class="right font-bold">${fmtMYR0(total)}</span></li>`);

list.sort((a,b)=> new Date(a.dueDate)-new Date(b.dueDate)).slice(0,6).forEach(p=>{

ul.insertAdjacentHTML('beforeend', `

<li>

${p.vendor || 'Unknown'}

${fmtMYR0(p.amount)}

 â€¢ ${d.toLocaleDateString('en-GB',{month:'short'})}

</span>

</li>

`);

});

if (idx<months.length-1) ul.insertAdjacentHTML('beforeend', `<li><div class="sep"></div></li>`);

});

if (months.length===0) ul.innerHTML = `<li><span class="left text-[var(--muted)] text-sm">No forecasted payments in next 90 days</span></li>`;

}

// Cashflow

let cashflowChart;

function renderCashflow(cf) {

const el = document.getElementById('cashflowChart'); if (!el) return;

const data = Array.isArray(cf) ? cf.slice() : [];

if (cashflowChart) { try { cashflowChart.destroy(); } catch(e){} cashflowChart = null; }

if (data.length === 0) { const ctx = el.getContext('2d'); if (ctx) ctx.clearRect(0,0,el.width,el.height); return; }

const labels = [data.map](http://data.map)(r => r.ym);

const scheduled = [data.map](http://data.map)(r => r.scheduled || 0);

const paid = [data.map](http://data.map)(r => r.paid || 0);

const style = getComputedStyle(document.body);

const scheduledColor = style.getPropertyValue('--nav').trim();

const paidColor = style.getPropertyValue('--brand').trim();

const gridColor = '#e5e7eb';

cashflowChart = new Chart(el.getContext('2d'), {

type: 'bar',

data: { labels, datasets: [

{ label: 'Scheduled', data: scheduled, backgroundColor: scheduledColor, borderRadius: 6 },

{ label: 'Paid', data: paid, backgroundColor: paidColor, borderRadius: 6 }

]},

options: {

responsive: true, maintainAspectRatio: false,

plugins: { legend: { position: 'bottom' } },

scales: {

x: { grid: { display: false } },

y: { beginAtZero: true, grid: { color: gridColor } }

}

}

});

}

// Top Vendors

function renderTopVendors(list){

const ul = document.getElementById('topVendors'); if (!ul) return; ul.innerHTML = '';

(list||[]).forEach(r => ul.insertAdjacentHTML('beforeend',

`<li class="flex justify-between items-center"><span class="truncate">${r.vendor}</span><span class="font-bold">${fmtMYR(r.amount)}</span></li>`));

}

// Gates compressed (Codelab-like)

function renderGatesCompressed(gates){

const ul = document.getElementById('gatesCompressed'); if (!ul) return; ul.innerHTML='';

(gates||[]).forEach(g=>{

const pct = g.required>0 ? Math.round((g.approved/g.required)*100) : 0;

ul.insertAdjacentHTML('beforeend', `

<li>

<div class="flex items-center justify-between mb-1">

${[g.id](http://g.id)}

${pct}%

</div>

<div class="progress"></div>

<div class="mt-1 text-[10px] text-[var(--muted)]">Req ${g.required} â€¢ Appr ${g.approved} â€¢ Subm ${g.submitted ?? 0} â€¢ Miss ${g.blocked}</div>

</li>

`);

});

if ((gates||[]).length===0) ul.innerHTML = `<li><span class="text-[var(--muted)] text-sm">No gate data</span></li>`;

}

// Existing attention items (kept for other panels)

function renderAlerts(a){

// Intentionally left minimal since we render compact lists separately

}

// STATUS + DATA FLOW

const statusEl = document.getElementById('status');

async function autoSummary(){

if (!dataCache) { document.getElementById('summaryOut').textContent = 'No data available for summary.'; return; }

try {

const resp = await fetch('/.netlify/functions/proxy', {

method:'POST', headers:{'Content-Type':'application/json'},

body: JSON.stringify({ type:'summary', data: dataCache })

});

const out = await resp.json().catch(()=>({}));

document.getElementById('summaryOut').textContent = out.text || 'No response.';

} catch (err) {

document.getElementById('summaryOut').textContent = 'AI summary unavailable.';

}

}

async function loadData(){

statusEl.textContent = 'Loadingâ€¦';

try {

const r = await fetch('/.netlify/functions/proxy', { headers:{'Accept':'application/json'} });

if (!r.ok) throw new Error(`HTTP ${r.status}`);

dataCache = await r.json();

renderKPIs(dataCache.kpis || {});

renderGoNoGo(dataCache.alerts || {});

renderCashflow(dataCache.cashflow || []);

renderTopVendors(dataCache.topVendors || []);

// New compact boards

renderOverdue(dataCache.alerts?.paymentsOverdue || []);

renderForecast90(dataCache.payments || []);

renderGatesCompressed(dataCache.gates || []);

statusEl.textContent = '';

} catch (err) {

statusEl.textContent = `Failed to load data: ${err.message}`;

console.error(err);

}

}

document.getElementById('genSummary').addEventListener('click', autoSummary);

// Boot

loadData().then(autoSummary).catch(err=>console.error(err));

</script>

</body>

</html>